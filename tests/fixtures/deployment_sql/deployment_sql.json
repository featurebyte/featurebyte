{
    "deployment_id": "646f6c1c0ed28a5271fb02d6",
    "feature_table_sqls": [
        {
            "feature_ids": [
                "646f6c1b0ed28a5271fb02c4"
            ],
            "feature_names": [
                "sum_30m"
            ],
            "sql_code": "WITH DEPLOYMENT_REQUEST_TABLE AS (\n  SELECT\n    REQ.\"cust_id\",\n    {{ CURRENT_TIMESTAMP }} AS POINT_IN_TIME\n  FROM (\n    SELECT DISTINCT\n      CAST(\"cust_id\" AS BIGINT) AS \"cust_id\"\n    FROM (\n      SELECT\n        \"col_int\" AS \"col_int\",\n        \"col_float\" AS \"col_float\",\n        \"col_char\" AS \"col_char\",\n        \"col_text\" AS \"col_text\",\n        \"col_binary\" AS \"col_binary\",\n        \"col_boolean\" AS \"col_boolean\",\n        \"event_timestamp\" AS \"event_timestamp\",\n        \"cust_id\" AS \"cust_id\"\n      FROM \"sf_database\".\"sf_schema\".\"sf_table\"\n      WHERE\n        \"event_timestamp\" >= CAST(FLOOR(\n          (\n            EXTRACT(epoch_second FROM CAST({{ CURRENT_TIMESTAMP }} AS TIMESTAMP)) - 300\n          ) / 1800\n        ) * 1800 + 300 - 600 - 1800 AS TIMESTAMP)\n        AND \"event_timestamp\" < CAST(FLOOR(\n          (\n            EXTRACT(epoch_second FROM CAST({{ CURRENT_TIMESTAMP }} AS TIMESTAMP)) - 300\n          ) / 1800\n        ) * 1800 + 300 - 600 AS TIMESTAMP)\n    )\n    WHERE\n      NOT \"cust_id\" IS NULL\n  ) AS REQ\n), \"REQUEST_TABLE_W1800_F1800_BS600_M300_cust_id\" AS (\n  SELECT\n    \"POINT_IN_TIME\",\n    \"cust_id\",\n    CAST(FLOOR((\n      DATE_PART(EPOCH_SECOND, \"POINT_IN_TIME\") - 300\n    ) / 1800) AS BIGINT) AS __FB_LAST_TILE_INDEX,\n    CAST(FLOOR((\n      DATE_PART(EPOCH_SECOND, \"POINT_IN_TIME\") - 300\n    ) / 1800) AS BIGINT) - 1 AS __FB_FIRST_TILE_INDEX\n  FROM (\n    SELECT DISTINCT\n      \"POINT_IN_TIME\",\n      \"cust_id\"\n    FROM DEPLOYMENT_REQUEST_TABLE\n  )\n), _FB_AGGREGATED AS (\n  SELECT\n    REQ.\"cust_id\",\n    REQ.\"POINT_IN_TIME\",\n    \"T0\".\"_fb_internal_cust_id_window_w1800_sum_e8c51d7d1ec78e1f35195fc0cf61221b3f830295\" AS \"_fb_internal_cust_id_window_w1800_sum_e8c51d7d1ec78e1f35195fc0cf61221b3f830295\"\n  FROM DEPLOYMENT_REQUEST_TABLE AS REQ\n  LEFT JOIN (\n    SELECT\n      \"POINT_IN_TIME\",\n      \"cust_id\",\n      SUM(value_sum_e8c51d7d1ec78e1f35195fc0cf61221b3f830295) AS \"_fb_internal_cust_id_window_w1800_sum_e8c51d7d1ec78e1f35195fc0cf61221b3f830295\"\n    FROM (\n      SELECT\n        REQ.\"POINT_IN_TIME\",\n        REQ.\"cust_id\",\n        TILE.INDEX,\n        TILE.value_sum_e8c51d7d1ec78e1f35195fc0cf61221b3f830295\n      FROM \"REQUEST_TABLE_W1800_F1800_BS600_M300_cust_id\" AS REQ\n      INNER JOIN TILE_SUM_E8C51D7D1EC78E1F35195FC0CF61221B3F830295 AS TILE\n        ON FLOOR(REQ.__FB_LAST_TILE_INDEX / 1) = FLOOR(TILE.INDEX / 1)\n        AND REQ.\"cust_id\" = TILE.\"cust_id\"\n      WHERE\n        TILE.INDEX >= REQ.__FB_FIRST_TILE_INDEX AND TILE.INDEX < REQ.__FB_LAST_TILE_INDEX\n      UNION ALL\n      SELECT\n        REQ.\"POINT_IN_TIME\",\n        REQ.\"cust_id\",\n        TILE.INDEX,\n        TILE.value_sum_e8c51d7d1ec78e1f35195fc0cf61221b3f830295\n      FROM \"REQUEST_TABLE_W1800_F1800_BS600_M300_cust_id\" AS REQ\n      INNER JOIN TILE_SUM_E8C51D7D1EC78E1F35195FC0CF61221B3F830295 AS TILE\n        ON FLOOR(REQ.__FB_LAST_TILE_INDEX / 1) - 1 = FLOOR(TILE.INDEX / 1)\n        AND REQ.\"cust_id\" = TILE.\"cust_id\"\n      WHERE\n        TILE.INDEX >= REQ.__FB_FIRST_TILE_INDEX AND TILE.INDEX < REQ.__FB_LAST_TILE_INDEX\n    )\n    GROUP BY\n      \"POINT_IN_TIME\",\n      \"cust_id\"\n  ) AS T0\n    ON REQ.\"POINT_IN_TIME\" = T0.\"POINT_IN_TIME\" AND REQ.\"cust_id\" = T0.\"cust_id\"\n)\nSELECT\n  AGG.\"cust_id\",\n  CAST(\"_fb_internal_cust_id_window_w1800_sum_e8c51d7d1ec78e1f35195fc0cf61221b3f830295\" AS DOUBLE) AS \"sum_30m\",\n  {{ CURRENT_TIMESTAMP }} AS \"POINT_IN_TIME\"\nFROM _FB_AGGREGATED AS AGG"
        }
    ]
}
